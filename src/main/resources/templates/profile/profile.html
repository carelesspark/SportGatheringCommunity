<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="profile/profilelayout">
<th:block layout:fragment="content">
    <div id="right">
        <div id="title">
            <h1 th:if="${session.RuserId != null}"><span th:text="${session.userNickname}"></span>님의 프로필</h1>
        </div>

        <div id="info1">
            <div id="profileImg">
                <div id="imgBox">
                    <img id="basicImg" src="/images/profile/circle_user.png">
                </div>
                <div id="editImgBox">
                    <button id="editImgBtn">프로필사진 수정</button>
                </div>
            </div>
            <div id="nickname">
                <p th:if="${session.RuserId != null}" th:text="${session.userNickname}"><span>님, 안녕하세요!</span></p>
                <button id="editNickname">
                    <i class="editsvg fi fi-rr-pen-square"></i>
                </button>
            </div>
        </div>

        <!--   프로필수정 모달창    -->
        <div class="modal fade" id="editProfileModal" tabindex="-1" role="dialog" aria-labelledby="editProfileModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="editProfileModalLabel">프로필 수정</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <!-- 수정할 프로필 정보를 입력하는 폼 -->
                        <form id="editProfileForm">
                            <div class="form-group">
                                <label for="newNickname">수정할 닉네임:</label>
                                <input type="text" class="form-control" id="newNickname" required>
                            </div>
                            <div class="form-group">
                                <label for="newEmail">수정할 이메일:</label>
                                <input type="email" class="form-control" id="newEmail" required>
                            </div>
                            <div class="form-group">
                                <label for="newAddress">수정할 주소:</label>
                                <input type="text" class="form-control" id="newAddress" required>
                            </div>
                            <div class="form-group">
                                <label for="newAddressDetail">수정할 상세주소:</label>
                                <input type="text" class="form-control" id="newAddressDetail">
                            </div>
                            <div class="form-group">
                                <label for="newPost">수정할 우편번호:</label>
                                <input type="text" class="form-control" id="newPost" required>
                            </div>
                            <button type="submit" class="btn btn-primary">저장</button>
                        </form>
                    </div>
                </div>
            </div>
        </div> <!--Modal End -->

        <div id="profileUpdateMessage" style="display: none;"></div>

        <div id="info2">
            <div><p>주소</p></div>
            <div>
                <div th:if="${session.userAddrDetail}">
                    <p th:text="${session.userAddrDetail}"></p>
                </div>
                <div th:unless="${session.userAddrDetail}">
                    <p>주소를 입력해주세요.</p>
                </div>
                <span>우편번호 찾기</span>
            </div>
        </div>

        <div id="info3">
            <div><p>이메일 주소</p></div>
            <div>
                <div th:if="${session.userEmail}">
                    <p th:text="${session.userEmail}"></p>
                </div>
                <div th:unless="${session.userEmail}">
                    <p>이메일 주소를 입력해주세요.</p>
                </div>
            </div>
        </div>

        <div id="editBtn">
            <button id="editProfileBtn">프로필 수정</button>
        </div>



        <link th:href="@{/css/profile/profileMain.css}" rel="stylesheet" type="text/css"/>
        <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
        <script>
            $(document).ready(function(){
                var isClicked = false;

                $('div#article a').hover(function () {
                    if (!isClicked) {
                        $(this).css("background-color", "#277DFF");
                        $(this).css("transition", "background 0.3s ease-in-out");
                        $('.icon5').css("fill", "white");
                        $('.icon5').css("transition", "fill 0.3s ease-in-out");
                        $('.icon6').css("fill", "white");
                        $('.icon6').css("transition", "fill 0.3s ease-in-out");
                    }
                }, function () {
                    if (!isClicked) {
                        $(this).css("background-color", "#4A4A4A");
                        $(this).css("transition", "background 0.3s ease-in-out");
                        $('.icon5').css("fill", "#A6A6A6");
                        $('.icon5').css("transition", "fill 0.3s ease-in-out");
                        $('.icon6').css("fill", "#A6A6A6");
                        $('.icon6').css("transition", "fill 0.3s ease-in-out");
                    }
                });

                $("#article>a").click(function () {
                    var submenu = $(this).next("div");

                    if (submenu.is(":visible")) {
                        submenu.slideUp();
                        isClicked = false;
                        $(this).css("background-color", "#4A4A4A");
                        $(this).css("transition", "background 0.3s ease-in-out");
                        $('.icon5').css("fill", "#A6A6A6");
                        $('.icon5').css("transition", "fill 0.3s ease-in-out");
                        $('.icon6').css("fill", "#A6A6A6");
                        $('.icon6').css("transition", "fill 0.3s ease-in-out");

                        $("#cs").animate({marginTop: '140px'}, 500);
                    } else {
                        submenu.slideDown();
                        isClicked = true;
                        $(this).css("background-color", "#277DFF");
                        $(this).css("transition", "background 0.3s ease-in-out");
                        $('.icon5').css("fill", "white");
                        $('.icon5').css("transition", "fill 0.3s ease-in-out");
                        $('.icon6').css("fill", "white");
                        $('.icon6').css("transition", "fill 0.3s ease-in-out");

                        $("#cs").animate({marginTop: '420px'}, 500);
                    }
                });

                $('div#cs a').hover(function () {
                    if (!isClicked) {
                        $(this).css("background-color", "#277DFF");
                        $(this).css("transition", "background 0.3s ease-in-out");
                        $('.icon5').css("fill", "white");
                        $('.icon5').css("transition", "fill 0.3s ease-in-out");
                        $('.icon6').css("fill", "white");
                        $('.icon6').css("transition", "fill 0.3s ease-in-out");
                    }
                }, function () {
                    if (!isClicked) {
                        $(this).css("background-color", "#4A4A4A");
                        $(this).css("transition", "background 0.3s ease-in-out");
                        $('.icon5').css("fill", "#A6A6A6");
                        $('.icon5').css("transition", "fill 0.3s ease-in-out");
                        $('.icon6').css("fill", "#A6A6A6");
                        $('.icon6').css("transition", "fill 0.3s ease-in-out");
                    }
                });

                $("#cs>a").click(function () {
                    var submenu = $(this).next("div");

                    if (submenu.is(":visible")) {
                        submenu.slideUp();
                        isClicked = false;
                        $(this).css("background-color", "#4A4A4A");
                        $(this).css("transition", "background 0.3s ease-in-out");
                        $('.icon5').css("fill", "#A6A6A6");
                        $('.icon5').css("transition", "fill 0.3s ease-in-out");
                        $('.icon6').css("fill", "#A6A6A6");
                        $('.icon6').css("transition", "fill 0.3s ease-in-out");
                    } else {
                        submenu.slideDown();
                        isClicked = true;
                        $(this).css("background-color", "#277DFF");
                        $(this).css("transition", "background 0.3s ease-in-out");
                        $('.icon5').css("fill", "white");
                        $('.icon5').css("transition", "fill 0.3s ease-in-out");
                        $('.icon6').css("fill", "white");
                        $('.icon6').css("transition", "fill 0.3s ease-in-out");
                    }
                });


               $('div#profile a').hover(function(){
                    $(this).css("background-color", "#277DFF");
                    $(this).css("transition", "background 0.3s ease-in-out");
                    $('.icon1').css("fill", "white");
                    $('.icon1').css("transition", "fill 0.3s ease-in-out");
               }, function() {
                    $(this).css("background-color", "#4A4A4A");
                    $(this).css("transition", "background 0.3s ease-in-out");
                    $('.icon1').css("fill", "#A6A6A6");
                    $('.icon1').css("transition", "fill 0.3s ease-in-out");
               });

               $('div#likeclub a').hover(function(){
                    $(this).css("background-color", "#277DFF");
                    $(this).css("transition", "background 0.3s ease-in-out");
                    $('.icon2').css("fill", "white");
                    $('.icon2').css("transition", "fill 0.3s ease-in-out");
               }, function() {
                    $(this).css("background-color", "#4A4A4A");
                    $(this).css("transition", "background 0.3s ease-in-out");
                    $('.icon2').css("fill", "#A6A6A6");
                    $('.icon2').css("transition", "fill 0.3s ease-in-out");
               });

               $('div#myclub a').hover(function(){
                    $(this).css("background-color", "#277DFF");
                    $(this).css("transition", "background 0.3s ease-in-out");
                    $('.icon3').css("fill", "white");
                    $('.icon3').css("transition", "fill 0.3s ease-in-out");
               }, function() {
                    $(this).css("background-color", "#4A4A4A");
                    $(this).css("transition", "background 0.3s ease-in-out");
                    $('.icon3').css("fill", "#A6A6A6");
                    $('.icon3').css("transition", "fill 0.3s ease-in-out");
               });

               $('div#article_comment a').hover(function(){
                    $(this).css("background-color", "#74C5FF");
                    $(this).css("transition", "background 0.3s ease-in-out");
                    $('.icon7').css("fill", "white");
                    $('.icon7').css("transition", "fill 0.3s ease-in-out");
               }, function() {
                    $(this).css("background-color", "#727272");
                    $(this).css("transition", "background 0.3s ease-in-out");
                    $('.icon7').css("fill", "#D6D6D6");
                    $('.icon7').css("transition", "fill 0.3s ease-in-out");
               });

               $('div#article_post a').hover(function(){
                    $(this).css("background-color", "#74C5FF");
                    $(this).css("transition", "background 0.3s ease-in-out");
                    $('.icon8').css("fill", "white");
                    $('.icon8').css("transition", "fill 0.3s ease-in-out");
               }, function() {
                    $(this).css("background-color", "#727272");
                    $(this).css("transition", "background 0.3s ease-in-out");
                    $('.icon8').css("fill", "#D6D6D6");
                    $('.icon8').css("transition", "fill 0.3s ease-in-out");
               });

               $('div#cs_faq a').hover(function(){
                    $(this).css("background-color", "#74C5FF");
                    $(this).css("transition", "background 0.3s ease-in-out");
                    $('.icon7').css("fill", "white");
                    $('.icon7').css("transition", "fill 0.3s ease-in-out");
               }, function() {
                    $(this).css("background-color", "#727272");
                    $(this).css("transition", "background 0.3s ease-in-out");
                    $('.icon7').css("fill", "#D6D6D6");
                    $('.icon7').css("transition", "fill 0.3s ease-in-out");
               });

               $('div#cs_notice a').hover(function(){
                    $(this).css("background-color", "#74C5FF");
                    $(this).css("transition", "background 0.3s ease-in-out");
                    $('.icon8').css("fill", "white");
                    $('.icon8').css("transition", "fill 0.3s ease-in-out");
               }, function() {
                    $(this).css("background-color", "#727272");
                    $(this).css("transition", "background 0.3s ease-in-out");
                    $('.icon8').css("fill", "#D6D6D6");
                    $('.icon8').css("transition", "fill 0.3s ease-in-out");
               });

               $('div#cs_onetoone a').hover(function(){
                    $(this).css("background-color", "#74C5FF");
                    $(this).css("transition", "background 0.3s ease-in-out");
                    $('.icon8').css("fill", "white");
                    $('.icon8').css("transition", "fill 0.3s ease-in-out");
               }, function() {
                    $(this).css("background-color", "#727272");
                    $(this).css("transition", "background 0.3s ease-in-out");
                    $('.icon8').css("fill", "#D6D6D6");
                    $('.icon8').css("transition", "fill 0.3s ease-in-out");
               });


                   // 프로필 수정 버튼 클릭 시 모달 열기
                    $('#editProfileBtn').on('click', function () {
                        // 모달 열기 등의 동작 추가
                        $('#editProfileModal').modal('show');
                    });

                    // 프로필 수정 폼 제출 시
                    $('#editProfileForm').submit(function (e) {
                        e.preventDefault(); // 폼 제출 기본 동작 막기

                        // 수정할 정보 값 가져오기
                        var newNickname = $('#newNickname').val();
                        var newEmail = $('#newEmail').val();
                        var newAddress = $('#newAddress').val();
                        var newAddressDetail = $('#newAddressDetail').val();
                        var newPost = $('#newPost').val();

                        // AJAX를 사용하여 서버로 수정 요청 보내기
                        $.ajax({
                            type: 'POST',
                            url: '/profile/update',
                            data: {
                                nickname: newNickname,
                                email: newEmail,
                                address: newAddress,
                                addressDetail: newAddressDetail,
                                post: newPost
                            },
                            success: function (response) {
                                // 서버로부터 성공 응답을 받았을 때의 동작
                                console.log('프로필 수정이 성공적으로 완료되었습니다.');

                                // 성공 메시지를 동적으로 생성하여 출력
                                var successMessage = '<div class="alert alert-success" role="alert">' + response.message + '</div>';
                                $('#profileUpdateMessage').html(successMessage).fadeIn(500).delay(3000).fadeOut(500);

                                location.reload();
                            },
                            error: function (xhr, status, error) {
                                // 서버로부터 실패 응답
                                console.error('프로필 수정 중 에러 발생: ' + error);

                                // 실패 메시지를 동적으로 생성하여 출력
                                var errorMessage = '<div class="alert alert-danger" role="alert">프로필 수정 중 에러가 발생했습니다. 다시 시도해주세요.</div>';
                                $('#profileUpdateMessage').html(errorMessage).fadeIn(500).delay(3000).fadeOut(500);
                            }
                        });
                    });
            }); <!--document Ready End-->
        </script>
    </div>
</th:block>
</html>